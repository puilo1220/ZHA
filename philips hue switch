blueprint:
  name: "Hue Dimmer v2 for IKEA - Trigger ID Version"
  description: "Select the Hue Dimmer device. Off button dims to 5%."
  domain: automation
  input:
    remote_device:
      name: Hue Dimmer Switch
      selector:
        device:
          integration: mqtt
    light_entity:
      name: Light Entity
      selector:
        target:
          entity:
            domain: light
    brightness_step:
      name: Brightness Step
      default: 10
      selector:
        number:
          min: 1
          max: 50
          unit_of_measurement: "%"

mode: restart

trigger:
  - platform: device
    domain: mqtt
    device_id: !input remote_device
    type: action
    subtype: "on-press"
    id: "on"
  - platform: device
    domain: mqtt
    device_id: !input remote_device
    type: action
    subtype: "off-press"
    id: "dim_to_min"
  - platform: device
    domain: mqtt
    device_id: !input remote_device
    type: action
    subtype: "up-press"
    id: "br_up"
  - platform: device
    domain: mqtt
    device_id: !input remote_device
    type: action
    subtype: "down-press"
    id: "br_down"
  - platform: device
    domain: mqtt
    device_id: !input remote_device
    type: action
    subtype: "hue-press"
    id: "color"

action:
  - choose:
      - conditions:
          - condition: trigger
            id: "on"
        sequence:
          - service: light.turn_on
            target: !input light_entity
            data:
              brightness_pct: 100

      - conditions:
          - condition: trigger
            id: "dim_to_min"
        sequence:
          - service: light.turn_on
            target: !input light_entity
            data:
              brightness_pct: 5

      - conditions:
          - condition: trigger
            id: "br_up"
        sequence:
          - service: light.turn_on
            target: !input light_entity
            data:
              brightness_step_pct: !input brightness_step

      - conditions:
          - condition: trigger
            id: "br_down"
        sequence:
          - service: light.turn_on
            target: !input light_entity
            data:
              brightness_step_pct: -10

      - conditions:
          - condition: trigger
            id: "color"
        sequence:
          - service: light.turn_on
            target: !input light_entity
            data:
              color_temp_kelvin: 3000
